- content_for :head do
  :javascript
    $(function() { initCollections(#{collections.to_json}); });

%h1 Collections
.box.nopadd.h50
  .left.w33.h50

    -# Collections
    <!-- ko if: !currentCollection() && !currentSite() -->
    .tableheader.w33
      My Collections
    .tablescroll
      %table.GralTable.CleanTable
        %tbody
          <!-- ko foreach: collections -->
          %tr
            %td
              %div
                %span{ko(:text => :name)}
              %button.farrow{ko(:click => '$root.enterCollection'), :type => :button}
          <!-- /ko -->
    .tablebottom{ko(:click => '$root.createCollection'), :style => 'cursor: pointer'}
      %button.cadd{:type => "button"}
      Create Collection
    <!-- /ko -->

    -# Sites template
    %script{:type => "text/html", :id => "sites-template"}
      <!-- ko foreach: sites -->
      %tr{ko(:css => "{closed: folder() && !expanded(), opened: folder() && expanded}")}
        %td
          %div
            <!-- ko if: folder() -->
            %span{ko(:text => :name, :style => "{marginLeft: '' + (10 + (level() - 1) * 20) + 'px'}", :css => "{selected: $data == $root.selectedSite()}", :click => '$root.selectSite')}
            <!-- /ko -->

            <!-- ko if: !folder() -->
            %p{ko(:style => "{marginLeft: '' + (10 + (level() - 1) * 20) + 'px'}", :css => "{selected: $data == $root.selectedSite()}", :click => '$root.selectSite'), :style => 'cursor: pointer'}
              %span.statR
              %span{ko(:text => :name)}
            <!-- /ko -->
          %button.farrow{ko(:click => '$root.editSite'), :type => "button"}
      <!-- ko if: expanded -->
      <!-- ko template: {name: 'sites-template', with: sites} -->
      <!-- /ko -->
      <!-- /ko -->
      <!-- /ko -->

    -# Collection sites
    <!-- ko if: !currentSite() -->
    <!-- ko with: currentCollection -->
    .tableheader.w33
      %button.fleft{ko(:click => '$root.goToRoot'), :type => 'button'}
      %span.i18b-groupChat
      %span{ko(:text => :name)}
      %button.fconfiguration.right{ko(:click => '$root.editCollection'), :type => 'button'}
    .tablescroll
      %table.GralTable.CleanTable
        %tbody
          <!-- ko template: {name: 'sites-template', with: $data} -->
          <!-- /ko -->
    .tablebottom
      <!-- ko if: !$root.selectedSite() || $root.selectedSite().folder() -->
      Add
      %button.ffolder{ko(:click => '$root.createGroup')} Group
      or
      %button.flocation{ko(:click => '$root.createSite')} Site
      <!-- ko if: $root.selectedSite() -->
      at
      %span{ko(:text => '$root.selectedSite().name()')}
      <!-- /ko -->
      <!-- /ko -->
    <!-- /ko -->
    <!-- /ko -->

    -# Group/Site form
    %form{ko(:with => :currentSite, :submit => '$root.saveSite', :attr => "{'action': '#' + $root.currentCollection().id()}"), :style => 'display:inline'}
      .tableheader.w33
        %button.fleft{ko(:click => '$root.exitSite'), :type => 'button'}
        %span.i18b-groupChat
        %span{ko(:visible => 'folder() && !id()')} New Group
        %span{ko(:visible => 'folder() && id()')} Edit Group
        %span{ko(:visible => '!folder() && !id()')} New Site
        %span{ko(:visible => '!folder() && id()')} Edit Site
      .tablescroll
        %table.GralTable.CleanTable
          %tbody
            %tr
              %td
                = label_tag :name
                = text_field_tag :name, '', :placeholder => 'Enter new group name', 'data-bind' => kov(:value => :name, :visible => :folder)
                = text_field_tag :name, '', :placeholder => 'Enter new site name', 'data-bind' => kov(:value => :name, :visible => '!folder()')
      .tablebottom
        %button.grey{:type => 'submit'} Done
        %span{ko(:click => '$root.exitSite')} Cancel
  .right
    Map
  .clear
