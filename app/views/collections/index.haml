- content_for :head do
  :javascript
    $(function() { initCollections(#{collections.to_json}); });

%h1 Collections
.box.nopadd.h50
  .left.w33.h50

    -# Collections
    <!-- ko if: root -->
    .tableheader.w33
      My Collections
    .tablescroll
      %table.GralTable.CleanTable
        %tbody
          <!-- ko foreach: collections -->
          %tr
            %td
              %div
                %span{ko(:text => :name)}
              %button.farrow{ko(:click => '$root.enterCollection'), :type => :button}
          <!-- /ko -->
    .tablebottom{ko(:click => '$root.enterCreateCollection'), :style => 'cursor: pointer'}
      %button.cadd{:type => "button"}
      Create Collection
    <!-- /ko -->

    -# Sites template
    %script{:type => "text/html", :id => "sites-template"}
      <!-- ko foreach: sites -->
      %tr{ko(:css => "{closed: !expanded(), opened: expanded}", :click => '$root.selectSite')}
        %td
          %div
            %span{ko(:text => :name, :style => "{marginLeft: '' + (10 + (level() - 1) * 20) + 'px'}", :css => "{selected: $data == $root.selectedSite()}")}
          %button.farrow{:type => "button"}
      <!-- ko if: expanded -->
      <!-- ko template: {name: 'sites-template', with: sites} -->
      <!-- /ko -->
      <!-- /ko -->
      <!-- /ko -->

    -# Collection sites
    <!-- ko with: selectedCollection -->
    .tableheader.w33
      %button.fleft{ko(:click => '$root.enterRoot'), :type => 'button'}
      %span.i18b-groupChat
      %span{ko(:text => :name)}
      %button.fconfiguration.right{ko(:click => '$root.editCollection'), :type => 'button'}
    .tablescroll
      %table.GralTable.CleanTable
        %tbody
          <!-- ko template: {name: 'sites-template', with: $root.selectedCollection} -->
          <!-- /ko -->
    .tablebottom
      Add
      %button.ffolder{ko(:click => '$root.enterCreateGroup')} Group
      or
      %button.flocation Site
      <!-- ko if: $root.selectedSite() -->
      at
      %span{ko(:text => '$root.selectedSite().name()')}
      <!-- /ko -->
    <!-- /ko -->

    -# Create group
    %form{ko(:with => :creatinGroupCollection, :submit => '$root.createGroup'), :action => '#', :style => 'display:inline'}
      .tableheader.w33
        %button.fleft{ko(:click => '$root.exitCreateGroup'), :type => 'button'}
        %span.i18b-groupChat
        %span New Group
      .tablescroll
        %table.GralTable.CleanTable
          %tbody
            %tr
              %td
                = label_tag :name
                = text_field_tag :name, '', :placeholder => 'Enter new group name', 'data-bind' => kov(:value => '$root.groupName')
      .tablebottom
        %button.grey{:type => 'submit'} Done
        Cancel
  .right
    Map
  .clear
